name: Docs Deploy

on:
  push:
    branches: [ main, master ]
    paths:
      - 'docs/**'
      - 'mkdocs.yml'

jobs:
  deploy:
    if: ${{ github.repository_owner == github.actor }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          persist-credentials: false

      - name: Build docs
        run: |
          if [ -f mkdocs.yml ]; then
            pipx install mkdocs-material || pip install mkdocs mkdocs-material
            mkdocs build --strict
          elif [ -f Doxyfile ]; then
            sudo apt-get update && sudo apt-get install -y doxygen graphviz
            doxygen Doxyfile
          else
            echo "No docs config; skipping" && exit 0
          fi

      - name: Deploy to GitHub Pages (MkDocs)
        if: ${{ hashFiles('mkdocs.yml') != '' }}
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./site
